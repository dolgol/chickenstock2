package ssg.com.a.dao;

import java.io.BufferedReader;
import java.io.FileReader;
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.SQLException;

import ssg.com.a.dto.stockDto;

public class stockDao {

    public static void main(String[] args) {
        String csvFilePath = "D:\\SpringFrameWorkSamples\\semitest\\korstocks.csv";

        try {
            // Establish database connection
            Connection conn = getDBConnection();

            // Parse CSV and insert into the database
            parseCsvAndInsertData(conn, csvFilePath);

            // Close the database connection
            conn.close();
        } catch (SQLException e) {
            e.printStackTrace();
        }
    }

    private static Connection getDBConnection() throws SQLException {
        String dbUrl = "jdbc:mysql://localhost:3306/mydb?serverTimeZone=Asia/Seoul";
        String dbUser = "root";
        String dbPassword = "1234";
        return DriverManager.getConnection(dbUrl, dbUser, dbPassword);
    }

    private static void parseCsvAndInsertData(Connection conn, String csvFilePath) throws SQLException {
        try {
            BufferedReader reader = new BufferedReader(new FileReader(csvFilePath));
            String line;
            int lineCount = 0;

            // Skip the header line if present
            reader.readLine();

            while ((line = reader.readLine()) != null) {
                String[] data = line.split("\t");
                if (data.length >= 9) {
                    int number = Integer.parseInt(data[0].trim());
                    String kos = data[1].trim();
                    String name = data[2].trim();
                    String up = data[3].trim();
                    String upup = data[4].trim();
                    String createDay = data[5].trim();
                    String president = data[6].trim();
                    String http = data[7].trim();
                    String area = data[8].trim();

                    // Create stockDto object
                    stockDto stock = new stockDto(number, kos, name, up, upup, createDay, president, http, area);

                    // Insert data into the database
                    insertDataIntoSkapiTable(conn, stock);
                    lineCount++;
                }
            }

            System.out.println("Inserted " + lineCount + " rows into the skapi table.");
            reader.close();
        } catch (Exception e) {
            e.printStackTrace();
        }
    }

    private static void insertDataIntoSkapiTable(Connection conn, stockDto stock) throws SQLException {
        String insertQuery = "INSERT INTO skapi (number, kos, name, up, upup, createDay, president, http, area) " +
                "VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)";

        PreparedStatement pstmt = conn.prepareStatement(insertQuery);
        pstmt.setInt(1, stock.getNumber());
        pstmt.setString(2, stock.getKos());
        pstmt.setString(3, stock.getName());
        pstmt.setString(4, stock.getUp());
        pstmt.setString(5, stock.getUpup());
        pstmt.setString(6, stock.getCreateDay());
        pstmt.setString(7, stock.getPresident());
        pstmt.setString(8, stock.getHttp());
        pstmt.setString(9, stock.getArea());

        pstmt.executeUpdate();
        pstmt.close();
    }
}




